syntax = "proto3";

package demo.pricing.api;

import "google/protobuf/empty.proto";

option java_package = "it.salspa.demo.spring.grpc.pricing.api";
option java_multiple_files = true;
option java_outer_classname = "PricingApiProto";

service PricingService {
    rpc CreatePrice (CreatePriceRequest) returns (PriceCodeResponse);
    rpc UpdatePrice (UpdatePriceRequest) returns (PriceCodeResponse);
    rpc GetPrice (PriceCodeRequest) returns (PriceResponse);
    rpc DeletePrice (PriceCodeRequest) returns (EmptyResponse);
    rpc ListPrice (google.protobuf.Empty) returns (PriceListResponse);
    rpc CalculatePrice (CalculatePriceRequest) returns (CalculatePriceResponse);
}

message CreatePriceRequest {
    PricingFrequency period = 2;
    repeated Bracket pricing_brackets = 3;
}

message UpdatePriceRequest {
    string code = 1;
    PricingFrequency period = 2;
    repeated Bracket pricing_brackets = 3;
}

message PriceResponse {
    string code = 1;
    PricingFrequency period = 2;
    repeated Bracket pricing_brackets = 3;
}

message PriceListResponse {
    repeated PriceResponse prices = 1;
}

message CalculatePriceRequest {
    string price_code = 2;
    double quantity = 3;
}

message CalculatePriceResponse {
    PricingFrequency period = 1;
    Bracket pricing_bracket = 2;
    double total_price = 3;
}

message Bracket {
    int32 order = 1;
    double min_quantity = 2;
    optional double max_quantity = 3;
    double unit_price = 4;
}

message PriceCodeRequest {
    string code = 1;
}

message PriceCodeResponse {
    string code = 1;
}

message EmptyResponse {
    bool success = 1;
    string message = 2;
}

enum PricingFrequency {
    MONTHLY = 0;
    YEARLY = 1;
}

